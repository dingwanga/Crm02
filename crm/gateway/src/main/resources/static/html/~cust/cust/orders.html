<!DOCTYPE html>
<html lang="en">
<head>
    <title>客户信息管理 - 客户信息 - 历史订单</title>
    <meta charset="UTF-8">
    <link href="../../css/style.css" rel="stylesheet" type="text/css">
    <script src="../../script/common.js"></script>
    <script src="../../../js/jquery-1.8.3.min.js"></script>
    <script>
        $(function () {
            var cust_no = localStorage.getItem("cust_no");
            $.ajax({
                url: "../../../cust/customer?no=" + cust_no,
                type: "get",
                success: function (obj) {
                    if (obj.code === 0) {
                        $("#cust_no").html(obj.result.cust_no);
                        $("#cust_name").html(obj.result.cust_name);
                    } else {
                        alert(obj.msg);
                    }
                }
            });

            $.ajax({
                url: "../../../cust/orders?odr_cust_no=" + cust_no,
                type: "get",
                success: function (obj) {
                    if (obj.code === 0) {
                        fillTable(obj.result);
                    } else {
                        alert("error");
                    }
                }
            });
        });

        function fillTable(param) {
            var table = $("#table");
            table.empty();
            var str = '<tr><th width="15%">订单编号</th>' +
                '<th width="20%">日期</th>' +
                '<th width="40%">送货地址</th>' +
                '<th width="15%">状态</th>' +
                '<th width="10%">操作</th></tr>';
            $.each(param.list, function (i, order) {
                var status = '未确认';
                if (order.odr_status === 2) {
                    status = "已确认";
                } else if (order.odr_status === 3) {
                    status = "已发货";
                } else if (order.odr_status === 4) {
                    status = "已回款";
                } else if (order.odr_status === 5) {
                    status = "坏账";
                }
                str += '<tr><td class="list_data_text">' + order.odr_id + '</td>' +
                    '<td class="list_data_text">' + formatDate(order.odr_date, 1) + '</td>' +
                    '<td class="list_data_text">' + order.odr_addr + '</td>' +
                    '<td class="list_data_text">' + status + '</td>' +
                    '<td class="list_data_op">' +
                    '<img onclick="toUrl(\'' + order.odr_id + '\',\'orders_detail.html\');" title="查看明细" src="../../images/bt_detail.gif" class="op_button"/>' +
                    '</td></tr>';
            });
            str += "<tr><th colspan='100' class='pager'>" +
                "<div class='pager'>" +
                "共" + param.count + "条记录&nbsp;&nbsp;" +
                "每页<input type='number' id='pageSize' value='" + param.pageSize + "' style='width:40px''/>条&nbsp;&nbsp;" +
                "第" + param.pageNo + "页/共" + param.pageCount + "页&nbsp;&nbsp;" +
                "<a href='javascript:search(1)'>第一页</a>&nbsp;" +
                "<a href='javascript:search(" + (param.pageNo - 1) + ")'>上一页</a>&nbsp;&nbsp;" +
                "<a href='javascript:search(" + (param.pageNo + 1) + ")'>下一页</a>&nbsp;&nbsp;" +
                "<a href='javascript:search(" + param.pageCount + ")'>最后一页</a>&nbsp;&nbsp;" +
                "转到<input type='number' min='1' id='pageNo' value='" + param.pageNo + "' style='width:50px'/>页" +
                "<button onclick='go();'>GO</button>" +
                "</div></th></tr>";
            table.append(str);
        }

        function go() {
            var pageNo = $("#pageNo").val();
            search(pageNo);
        }

        function search(pageNo) {
            var pageSize = $("#pageSize").val();
            var cust_no = localStorage.getItem("cust_no");
            var data = "pageNo=" + pageNo + "&pageSize=" + pageSize + "&odr_cust_no=" + cust_no;
            $.ajax({
                url: "../../../cust/orders",
                type: "get",
                data: data,
                success: function (obj) {
                    if (obj.code === 0) {
                        fillTable(obj.result);
                    } else {
                        alert("error");
                    }
                }
            });
        }
    </script>
</head>
<body>
<div class="page_title">客户信息管理&nbsp;&nbsp;&gt;&nbsp;&nbsp;客户信息&nbsp;&nbsp;&gt;&nbsp;&nbsp;历史订单</div>
<div class="button_bar">
    <button class="common_button" onclick="help('历史订单');">帮助</button>
    <button class="common_button" onclick="back();">返回</button>
</div>
<table class="query_form_table">
    <tr>
        <th>客户编号</th>
        <td id="cust_no"></td>
        <th>客户名称</th>
        <td id="cust_name"></td>
    </tr>
</table>
<br/>
<table class="data_list_table" id="table">
</table>
</body>
</html>