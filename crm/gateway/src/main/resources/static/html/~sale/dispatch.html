<!DOCTYPE html>
<html lang="en">
<head>
    <title>销售机会管理 - 指派销售机会</title>
    <meta charset="UTF-8">
    <link href="../css/style.css" rel="stylesheet" type="text/css">
    <script src="../script/common.js"></script>
    <script src="../../js/jquery-1.8.3.min.js"></script>
    <script>
        $(function () {
            var id = localStorage.getItem("id");
            $.ajax({
                url: "../../marketing/list/" + id,
                type: "get",
                contentType: "application/json;charset=utf-8",
                success: function (obj) {
                    $("#id").html(obj.result.chc_id);
                    $("#source").html(obj.result.chc_source);
                    $("#cust_name").html(obj.result.chc_cust_name);
                    $("#rate").html(obj.result.chc_rate);
                    $("#title").html(obj.result.chc_title);
                    $("#linkman").html(obj.result.chc_linkman);
                    $("#tel").html(obj.result.chc_tel);
                    $("#desc").html(obj.result.chc_desc);
                    $("#create_by").html(obj.result.chc_create_by);
                    $("#create_date").html(formatDate(obj.result.chc_create_date));
                }
            });

            $.ajax({
                url: "../../user/listbyrole/3",
                type: "get",
                contentType: "application/json;charset=utf-8",
                success: function (obj) {
                    var str = "";
                    $.each(obj.result, function (i, user) {
                        str += "<option value='" + user.usr_id + "'>" + user.usr_name + "</option>";
                    });
                    $("#due_id").append(str);
                }
            });
        });

        function submit() {
            var chc_id = $("#id").html();
            var chc_due_id = $("#due_id").val();
            if (chc_due_id == 0) {
                alert("请选择指派人员！");
            } else {
                var data = '{chc_id:"' + chc_id + '",chc_due_id:"' + chc_due_id + '"}';
                $.ajax({
                    url: "../../marketing/due",
                    data: data,
                    type: "put",
                    dataType: "json",
                    contentType: "application/json;charset=utf-8",
                    success: function (obj) {
                        if (obj.code === 0) {
                            save('list.html');
                        } else {
                            alert(obj.msg);
                        }
                    }
                });
            }
        }
    </script>
</head>
<body>
<div class="page_title">销售机会管理&nbsp;&nbsp;&gt;&nbsp;&nbsp;指派销售机会</div>
<div class="button_bar">
    <button class="common_button" onclick="help('指派销售机会');">帮助</button>
    <button class="common_button" onclick="back();">返回</button>
    <button class="common_button" onclick="submit();">保存</button>
</div>
<table class="query_form_table">
    <tr>
        <th>编号</th>
        <td id="id"></td>
        <th>机会来源</th>
        <td id="source"></td>
    </tr>
    <tr>
        <th>客户名称</th>
        <td id="cust_name"></td>
        <th>成功机率（%）</th>
        <td id="rate"></td>
    </tr>
    <tr>
        <th>概要</th>
        <td colspan="3" id="title"></td>
    </tr>
    <tr>
        <th>联系人</th>
        <td id="linkman"></td>
        <th>联系人电话</th>
        <td id="tel"></td>
    </tr>
    <tr>
        <th>机会描述</th>
        <td colspan="3" id="desc"></td>
    </tr>
    <tr>
        <th>创建人</th>
        <td id="create_by"></td>
        <th>创建时间</th>
        <td id="create_date"></td>
    </tr>
</table>
<br/>
<table class="query_form_table" id="table">
    <tr>
        <th>指派给</th>
        <td>
            <select id="due_id">
                <option value="0">请选择...</option>
            </select> <span class="red_star">*</span></td>
        <th>指派时间</th>
        <td>
            <input id="due_date" readonly/><span class="red_star">*</span></td>
    </tr>
</table>
<script>
    setCurTime('due_date');
</script>
</body>
</html>